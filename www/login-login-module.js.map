{"version":3,"sources":["webpack:///./src/app/usuario/login/login.module.ts","webpack:///./src/app/usuario/login/login.page.html","webpack:///./src/app/usuario/login/login.page.scss","webpack:///./src/app/usuario/login/login.page.ts"],"names":[],"mappings":"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","file":"login-login-module.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\nimport { IonicModule } from '@ionic/angular';\nimport { LoginPage } from './login.page';\nimport { TranslateModule, TranslateLoader } from '@ngx-translate/core';\nimport { setTranslateLoader } from 'src/app/app.module';\nimport { HttpClient } from '@angular/common/http';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: LoginPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes),\n    TranslateModule.forChild({\n      loader: {\n        provide: TranslateLoader,\n        useFactory: (setTranslateLoader), deps: [HttpClient]\n      }\n    })\n  ],\n  declarations: [LoginPage]\n})\nexport class LoginPageModule { }\n","module.exports = \"<ion-header no-border color=\\\"primary\\\">\\n  <ion-toolbar color=\\\"primary\\\">\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-toggle>\\n        <ion-button>\\n          <ion-icon slot=\\\"icon-only\\\" name=\\\"menu\\\"></ion-icon>\\n        </ion-button>\\n      </ion-menu-toggle>\\n    </ion-buttons>\\n    <ion-title>\\n      <span style=\\\"font-weight:normal\\\">BlueBike</span>\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content padding style=\\\"background: none transparent;\\\">\\n  <img src=\\\"assets/imgs/tree.gif\\\" height=\\\"100%\\\">\\n</ion-content>\"","module.exports = \"ion-app {\\n  background: none transparent; }\\n\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9jYXJsb3NzZXJyYW5vL2lvbmljL0JsdWVCaWtlL3NyYy9hcHAvdXN1YXJpby9sb2dpbi9sb2dpbi5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSw2QkFBNEIsRUFDL0IiLCJmaWxlIjoic3JjL2FwcC91c3VhcmlvL2xvZ2luL2xvZ2luLnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbImlvbi1hcHB7XG4gICAgYmFja2dyb3VuZDogbm9uZSB0cmFuc3BhcmVudDtcbn0gXG4iXX0= */\"","import { Component, OnInit, TestabilityRegistry } from '@angular/core';\nimport { QRScanner, QRScannerStatus } from '@ionic-native/qr-scanner/ngx';\nimport { AlertController, NavController, ToastController } from '@ionic/angular';\nimport { TranslateService } from '@ngx-translate/core';\nimport { CustomLoadingModule } from 'src/app/customModules/custom-loading/custom-loading.module';\nimport { CloudService } from 'src/app/servicios/cloud.service';\nimport { Dialogs } from '@ionic-native/dialogs/ngx';\nimport { Vibration } from '@ionic-native/vibration/ngx';\nimport { CustomToastModule } from 'src/app/customModules/custom-toast/custom-toast.module';\nimport { AuthenticationService } from 'src/app/servicios/authentication.service';\nimport { environment } from 'src/environments/environment.prod';\n\n@Component({\n  selector: 'app-login',\n  templateUrl: './login.page.html',\n  styleUrls: ['./login.page.scss'],\n})\nexport class LoginPage implements OnInit {\n\n  id = null;\n\n  constructor(private qrScanner: QRScanner, private alertController: AlertController,\n    private translate: TranslateService, private navCtrl: NavController,\n    private loading: CustomLoadingModule,\n    private cloud: CloudService,\n    private dialogs: Dialogs,\n    private vibration: Vibration,\n    private toast: CustomToastModule,\n    private authS: AuthenticationService) { }\n  scanSub: any;\n\n  ionViewWillLeave() {\n    //Es llamado cuando realizamos una navegación porque ya hemos escaneado el QR\n    window.document.querySelector('ion-app').classList.remove('cameraView');\n    this.qrScanner.hide().then(() => {\n      this.qrScanner.destroy();\n    });\n  }\n\n  ngOnDestroy() {\n    //Es llamado cuando salimos de la página pulsando el botón atrás.\n    window.document.querySelector('ion-app').classList.remove('cameraView');\n    this.qrScanner.hide().then(() => {\n      this.qrScanner.destroy();\n    });\n  }\n  ngOnInit() { }\n  ionViewWillEnter() {\n    this.id = null;\n    this.qrScanner.prepare()\n      .then((status: QRScannerStatus) => {\n        //Cámara preparada\n        if (status.authorized) {\n          this.qrScanner.show();  //Mostramos cámara\n          window.document.querySelector('ion-app').classList.add('cameraView');  //ocultamos vista de la app\n          this.scanSub = this.qrScanner.scan().subscribe((d) => {\n            this.analizeData(d);  //Hemos leído un QR y vamos a analizarlo\n          });\n        } else if (status.denied) {\n          /* No hay permisos, abrimos configuración de permisos*/\n          console.log(\"denied\");\n          this.qrScanner.openSettings();\n        } else {\n          // permission was denied, but not permanently. You can ask for permission again at a later time.\n          console.log(\"other denied\");\n        }\n      })\n      .catch((e: any) => console.log('Error is', e));\n  }\n\n  analizeData(d: string) {\n    //BEEP\n    this.dialogs.beep(1);\n    this.vibration.vibrate(500);\n    let regex = new RegExp(\"[\\\\r\\\\n]\" + environment.QRf1 + \"\\\\:(.+)\", \"i\");\n    let test = d.match(regex);\n    let nombre = null;\n    if (test) {\n      nombre = test[1];\n    }\n    regex = new RegExp(environment.QRf2 + \"\\\\:(.+)\", \"i\")\n    test = d.match(regex);\n    let grupo = null;\n    if (test) {\n      grupo = test[1];\n    }\n    this.id = nombre + \" \" + grupo;\n    if (nombre == \"\" || nombre == null || grupo == \"\" || grupo == null) {\n      this.pauseQR();\n      this.dialogs.alert(this.translate.instant(\"errorQR\"),\"Error\");\n      this.resumeQR(); \n    } else {\n      this.pauseQR();\n      this.presentAlertConfirm(this.translate.instant('loginas') + \":<br><strong style='font-size:1.2rem'>\" + this.id + \"</strong> ?\", this.id);\n    }\n\n  }\n  pauseQR() {\n    this.qrScanner.hide();\n    this.qrScanner.pausePreview();\n    window.document.querySelector('ion-app').classList.remove('cameraView');\n  }\n  resumeQR() {\n    this.qrScanner.show();\n    this.qrScanner.resumePreview();\n    this.scanSub = this.qrScanner.scan().subscribe((d) => {\n      this.analizeData(d);\n    });\n    window.document.querySelector('ion-app').classList.add('cameraView');\n  }\n  closeQR() {\n    window.document.querySelector('ion-app').classList.remove('cameraView');\n    this.qrScanner.hide().then(() => {\n      this.qrScanner.destroy();\n    });\n    this.scanSub.unsubscribe(); // stop scanning\n  }\n  LoginUser(id) {\n    return new Promise((resolve, reject) => {\n      this.cloud.getIdFromName(id).then(() => {\n        this.cloud.getPic(id).then((d) => {\n          this.authS.avatar = d;\n          this.authS.setId(id, \"user\").then(() => {\n            resolve();\n          })\n        });\n\n      })\n    });\n\n  }\n  async presentAlertConfirm(msg, id) {\n    const alert = await this.alertController.create({\n      header: '',\n      message: msg,\n      cssClass: 'profalert',\n      buttons: [\n        {\n          text: this.translate.instant(\"cancel\"),\n          role: 'cancel',\n          cssClass: 'cancelo',\n          handler: (blah) => {\n            alert.dismiss();\n            this.resumeQR();\n          }\n        }, {\n          text: 'Ok',\n          cssClass: 'ok',\n          handler: () => {\n            this.loading.show(\"\");\n            this.LoginUser(id).then(() => {\n              alert.dismiss();\n              this.loading.hide();\n              this.navCtrl.navigateBack(['/usuario/home']);\n            });\n          }\n        }\n      ]\n    });\n\n    await alert.present();\n  }\n\n}\n"],"sourceRoot":""}